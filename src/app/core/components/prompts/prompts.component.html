<div class="container">
  <div class="top">
    <h2>Thread: {{ stateService.getSelectedThread()?.title }}</h2>
    <button
      *ngIf="stateService.getSelectedThread()"
      type="button"
      (click)="onDeleteThread(stateService.getSelectedThread()!.id)"
    >
      Delete
    </button>
  </div>
  <div class="thread-info" *ngIf="stateService.getSelectedThread()">
    <h2>
      Model: {{ stateService.getSelectedThread()!.model_name }} -
      {{ stateService.getSelectedThread()!.is_online ? "Online" : "Offline" }}
    </h2>
  </div>
  <h5 *ngIf="stateService.getSelectedThread()" style="font-weight: bold">
    {{
      stateService.getSelectedThread()!.first_prompt_datetime | date : "long"
    }}
  </h5>
  @for (prompt of prompts(); track prompt.id) {
  <div class="prompt-card">
    <h4><b>Prompt:</b> {{ prompt.prompt }}</h4>
    <h4><b>Response:</b></h4>
    <div class="response">
      <markdown [data]="prompt.response"></markdown>
    </div>
  </div>
  }

  <div class="form-container">
    <form [formGroup]="promptForm" (ngSubmit)="onSubmit()">
      <div>
        <label for="prompt"><b>Enter new prompt:</b></label>
        <textarea id="prompt" formControlName="prompt" type="text"> </textarea>
        <div
          *ngIf="
            promptForm.get('prompt')?.invalid &&
            promptForm.get('prompt')?.touched
          "
        >
          <small *ngIf="promptForm.get('prompt')?.errors?.['required']"
            >Prompt is required.</small
          >
        </div>
      </div>

      <button type="submit" [disabled]="promptForm.invalid || submitting">
        Send
      </button>
      <span *ngIf="submitting">Waiting response...</span>
    </form>
  </div>
</div>
